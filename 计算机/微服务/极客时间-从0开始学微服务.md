# 开篇词

服务化的解决方案，对原有的单体应用架构进行改造，把功能相对独立的模块拆分出去，部署为微服务，分别交给专门的更小的团队来维护。后来我们又引入了 Docker 容器化，以及 Service Mesh 等技术，更好地适应微博业务的高速发展。

微博的信息流后端架构经历了单体应用 - 微服务架构 - 容器化应用 - DevOps 的发展历程

微服务发展到现在，已经不再单单局限于微服务架构本身，还与容器化、DevOps 等新的理念相结合，能更好地迎合移动互联网业务快速迭代的要求。

# 到底什么是微服务

微服务的概念最早是在 **2014** 年由 **Martin Fowler** 和 **James Lewis** 共同提出，他们定义了微服务是由单一**应用程序**构成的**小服务**，拥有自己的进程与轻量化处理，服务依业务功能设计，以**全自动**的方式**部署**，与其他服务使用 **HTTP API 通讯**。同时，服务会使用最小规模的**集中管理** （例如 Docker）技术，服务可以用**不同的编程语言与数据库**等。

## 单体应用

早些年，各大互联网公司的应用技术栈大致可分为 LAMP（Linux + Apache + MySQL + PHP）和 MVC（Spring + iBatis/Hibernate + Tomcat）两大流派。无论是 LAMP 还是 MVC，都是为单体应用架构设计的，其优点是**学习成本低，开发上手快，测试、部署、运维也比较方便**，甚至一个人就可以完成一个网站的开发与部署。

早期在业务规模不大、开发团队人员规模较小的时候，采用单体应用架构，团队的开发和运维成本都可控。

业务规模的不断扩大，团队开发人员的不断扩张，单体应用架构就会开始出现的问题：

- 部署效率低下。（打包编译时间长）
- 团队协作开发成本高。（代码容易冲突）
- 系统高可用性差。（一个模块有故障影响其他模块）
- 线上发布变慢。（启动慢）

## 服务化

服务化就是把传统的单机应用中通过 JAR 包依赖产生的本地方法调用，改造成通过 RPC 接口产生的远程方法调用。

## 微服务

微服务相比于服务化又有什么不同点：

- 服务拆分粒度更细。（子模块只要耦合低也可拆）

  > 以保险系统为例，服务化的系统拆分可按 承保、理赔、销管、核算、资金、总账 等大的业务模块来分。
  >
  > 进一步微服务化，可将共有的用户、权限、工作流、网关、保监会平台交互、短信邮箱服务等功能独立，将大业务中的子模块拆分，如果承保拆分为核心（车险承保、车险批改、非车险承保、非车险批改、产品管理）渠道前置（互联网业务、线下业务）等等

- 服务独立部署。（彼此互不影响，一个Docker实例一个服务）

- 服务独立维护。（小团队维护生命周期）

- 服务治理能力要求高。（服务太多，需要服务治理平台）

微服务架构是将复杂臃肿的单体应用进行细粒度的服务化拆分，每个拆分出来的服务各自独立打包部署，并交由小团队进行开发和运维，从而极大地提高了应用交付的效率。

# 从单体应用走向服务化

## 什么时候进行服务化拆分？

项目**第一阶段**的主要目标是**快速开发和验证想法**，证明产品思路是否可行。这个阶段功能设计一般不会太复杂，开发采取快速迭代的方式，架构也**不适合过度设计**。所以将所有功能打包部署在一起，集中地进行开发、测试和运维，对于项目起步阶段，是最**高效也是最节省成本**的方式。

产品上线后，经过一段时间的运营，用户开始逐步增多，可行性验证通过，下一阶段就需要进一步增加更多的新特性来吸引更多的目标用户。这时候就需要大规模地扩张开发人员，以支撑多个功能的开发。如果继续采用单体应用架构，就会**出现单体应用给团队协作和系统性能带来的各种弊端**。

一旦单体应用同时进行开发的人员超过 10 人，就会遇到上面的问题，这个时候**就该考虑进行服务化拆分**了。

